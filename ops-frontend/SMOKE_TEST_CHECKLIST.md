# 前端冒烟测试执行清单

**测试日期**: _____________  
**测试人员**: _____________  
**测试环境**:
- 前端: http://localhost:5173
- 后端: http://localhost:3001
- 浏览器: Chrome _____________

---

## 前置准备

- [ ] 后端服务已启动（`cd backend && npm run dev`）
- [ ] 前端服务已启动（`cd ops-frontend && pnpm dev`）
- [ ] 数据库迁移已完成（`cd backend && npm run migration:run`）
- [ ] 测试数据已准备（执行`backend/scripts/smoke-test-improved.sh`）
- [ ] 截图目录已创建（`ops-frontend/screenshots/`）

---

## 测试用例清单

### ✅ 测试用例 1: 默认筛选"近7天 + DESC"（PR-12）

**执行步骤**:
1. [ ] 打开浏览器，访问 http://localhost:5173
2. [ ] 进入"AR待处理列表"页面
3. [ ] 观察筛选条件和列表数据

**验收点**:
- [ ] 日期筛选器自动设置为"近7天"
- [ ] 列表按"到款时间"降序排列（最新的在最上面）
- [ ] 状态筛选默认为"全部"或"未分配"

**Console验证**:
```javascript
console.log(localStorage.getItem('ar-payment-filters'));
// 应该看到类似：{"date_from":"2026-01-05","date_to":"2026-01-12","status":"UNAPPLIED"}
```

**截图**: `screenshots/test-case-1-default-filters.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 2: 用户偏好记忆（PR-12）

**执行步骤**:
1. [ ] 在"AR待处理列表"页面
2. [ ] 修改筛选条件（状态改为"已分配"，日期改为"2026-01-01 至 2026-01-05"）
3. [ ] 点击"查询"按钮
4. [ ] 刷新页面（F5）

**验收点**:
- [ ] 刷新后，筛选条件仍为"已分配"和"2026-01-01 至 2026-01-05"
- [ ] 列表数据与刷新前一致

**截图**: `screenshots/test-case-2-filter-memory.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 3: 空态展示（PR-13）

**执行步骤**:
1. [ ] 在"AR待处理列表"页面
2. [ ] 修改筛选条件，使结果为空（例如：日期设置为未来某天）
3. [ ] 点击"查询"按钮

**验收点**:
- [ ] 显示空态图标和文案："暂无数据"
- [ ] 显示"修改筛选"或"重试"按钮
- [ ] 无白屏或加载中状态

**截图**: `screenshots/test-case-3-empty-state.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 4: 异常态展示与重试（PR-13）

**执行步骤**:
1. [ ] 打开Chrome DevTools（F12）
2. [ ] 切换到"Network"标签
3. [ ] 勾选"Offline"模拟断网
4. [ ] 在"AR待处理列表"页面点击"查询"按钮
5. [ ] 观察错误提示
6. [ ] 取消"Offline"勾选
7. [ ] 点击"重试"按钮

**验收点**:
- [ ] 断网时显示错误提示："网络错误，请检查网络连接"
- [ ] 显示"重试"按钮
- [ ] 点击"重试"后，成功加载数据
- [ ] 弱网（慢3G）时显示Loading骨架，无白屏

**截图**: 
- `screenshots/test-case-4-error-state.png`
- `screenshots/test-case-4-retry-success.png`

**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 5: 进入详情页（PR-7）

**执行步骤**:
1. [ ] 在"AR待处理列表"页面
2. [ ] 点击任意一条收款单的"核销"按钮
3. [ ] 观察页面跳转

**验收点**:
- [ ] 页面跳转到详情页（URL: `/ar/apply/:paymentId`）
- [ ] 详情页显示收款单信息（客户、金额、到款时间等）
- [ ] 显示该客户的未结清应收单列表
- [ ] 浏览器后退按钮可用

**截图**: `screenshots/test-case-5-detail-page.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 6: 金额输入校验（PR-7）

**执行步骤**:
1. [ ] 在详情页
2. [ ] 在某个应收单的"核销金额"输入框中输入超过"剩余可分配金额"的数值
3. [ ] 尝试提交

**验收点**:
- [ ] 输入框显示红色边框
- [ ] 显示错误提示："核销金额不能超过剩余可分配金额"
- [ ] "提交核销"按钮禁用（灰色）

**截图**: `screenshots/test-case-6-amount-validation.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 7: 提交按钮禁用与Loading（PR-7）

**执行步骤**:
1. [ ] 在详情页
2. [ ] 正确填写核销金额
3. [ ] 点击"提交核销"按钮
4. [ ] 观察按钮状态

**验收点**:
- [ ] 点击后，按钮立即变为禁用状态（灰色）
- [ ] 按钮文字变为"提交中..."并显示Loading图标
- [ ] "取消"按钮也被禁用
- [ ] 提交成功或失败后，按钮恢复可用状态

**截图**: `screenshots/test-case-7-submit-loading.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 8: 409并发冲突提示（PR-7）

**执行步骤**:
1. [ ] 在详情页（Payment ID: P1）
2. [ ] 打开第二个浏览器窗口，访问同一个详情页
3. [ ] 在第二个窗口中先提交核销（成功）
4. [ ] 回到第一个窗口，再次提交核销
5. [ ] 观察错误提示

**验收点**:
- [ ] 显示Toast提示："数据已被他人更新，请刷新后重试"
- [ ] 提示框为红色或警告样式
- [ ] 按钮恢复可用状态
- [ ] 页面数据自动刷新（或提示用户手动刷新）

**截图**: `screenshots/test-case-8-409-conflict.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ⭐ 测试用例 9: 埋点事件验证（PR-14）**【关键】**

**执行步骤**:
1. [ ] 打开Chrome DevTools（F12）
2. [ ] 切换到"Console"标签
3. [ ] 在详情页填写核销金额并提交
4. [ ] 观察Console中的埋点日志

**验收点**:
- [ ] `apply_submit` 事件包含以下字段：
  - [ ] `payment_id`: 收款单ID
  - [ ] `applied_total_fen`: 总核销金额（分）
  - [ ] `remain_fen_after`: 核销后剩余金额（分）
  - [ ] `invoice_count`: 核销的发票数量
- [ ] `apply_success` 事件包含相同字段
- [ ] `apply_conflict` 事件（409错误时）包含相同字段

**Console验证**:
```javascript
// 应该看到类似：
// [Analytics] apply_submit: {payment_id: "P1", applied_total_fen: 2000, remain_fen_after: 3000, invoice_count: 1}
```

**截图**: `screenshots/test-case-9-analytics.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

**决策点**:
- ✅ 如果通过：说明功能已存在，不需要新PR
- ❌ 如果失败：需要创建PR fix(ops-ar): unify analytics fields

---

### ✅ 测试用例 10: 快速填充功能（PR-7）

**执行步骤**:
1. [ ] 在详情页
2. [ ] 点击某个应收单旁边的"快速填充"按钮
3. [ ] 观察金额输入框

**验收点**:
- [ ] 金额输入框自动填充为"剩余可分配金额"
- [ ] 如果剩余金额大于应收单余额，则填充应收单余额
- [ ] 填充后，"剩余可分配金额"实时更新

**截图**: `screenshots/test-case-10-quick-fill.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

### ✅ 测试用例 11: 金额显示格式（PR-7）

**执行步骤**:
1. [ ] 在列表页和详情页观察所有金额字段

**验收点**:
- [ ] 所有金额显示为"元"（保留两位小数）
- [ ] 例如：5000分显示为"¥50.00"
- [ ] 输入框中输入"50"，提交时转换为5000分

**截图**: `screenshots/test-case-11-amount-format.png`  
**状态**: ⬜ 未测试 / ✅ 通过 / ❌ 失败  
**备注**: _____________

---

## 测试结果汇总

| 类别 | 通过 | 失败 | 未测试 |
|------|------|------|--------|
| 必须通过（Blocking） | ___ / 9 | ___ | ___ |
| 建议通过（Non-blocking） | ___ / 2 | ___ | ___ |
| **总计** | ___ / 11 | ___ | ___ |

---

## 发现的问题

1. _____________
2. _____________
3. _____________

---

## PR #14决策

根据测试用例9的结果：

- [ ] ✅ **通过** - 埋点字段完整，不需要新PR
- [ ] ❌ **失败** - 需要创建PR fix(ops-ar): unify analytics fields

缺失的字段：_____________

---

## 测试结论

- [ ] ✅ 所有必须通过的测试用例通过，建议合并
- [ ] ⚠️ 部分测试用例失败，需要修复后重新测试
- [ ] ❌ 关键测试用例失败，不建议合并

---

## 测试人员签名

姓名: _____________  
日期: _____________  
签名: _____________

---

**文档版本**: v1.0  
**最后更新**: 2026-01-12
